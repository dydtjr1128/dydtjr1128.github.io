---
layout: post
title:  "(WIP)소프트웨어(exe) 파일 디지털 서명, 전자 서명 이해하기"
subtitle: "Understanding executable software code sign."
date: 2020-05-09 10:08:10 +0900
background: '/img/posts/07.jpg'
comments: true
catalog: true
categories: CPP
tags : CPP
lastmod :  2020-05-09 10:08:10 +0900
sitemap:
   changefreq: daily
   priority: 1.0
---

### Intro

실제로 동작하는 거의 모든 프로그램들은 전자 서명이 등록되어 있는 상태로 동작한다.
`.exe` 바이너리 내부에 서명된 내용을 통해 누가 배포한지를 알 수 있게 된다. 만약 특정 소프트웨어가 업데이트가 필요하다고 할 때 이러한 전자 서명을 보고 변조된 파일인지(해커에 의한 파일 변경 혹은 다른 파일)를 판별 할 수 있도록 해준다.
또한 이러한 전자 서명이 위조 되더라도 위조 여부를 쉽게 알아 낼 수 있는 기술적인 장치들이 있기 때문에 안정하고 정확하게 바이너리 프로그램의 진위 여부를 확인 할 수 있다.

### 전자 서명의 기반 기술

전자 서명은 해시 함수와 공개키 암호화를 기반으로 동작하게 된다. 그렇기 때문에 전자 서명을 이해하기 위해서는 두 가지 기술을 이해 해야 한다.

#### 해시 함수

해시 함수는 0과 1로 이루어진 바이너리의 특징을 축약하는 해시값을 결과로 내 보내 주는 기능을 한다. 이러한 해시 값은 유일성(Unique)을 보장하도록 만들어져 있다. 사실 희박한 확률로 충돌이 발생 할 수 있지만 이는 매우 적은 확률로 무시될 만한 정도를 가지고 있다.
해쉬값은 단 방향성을 가지며 한번 해시함수를 통해 나온 결과값을 다시 원래의 값으로 되돌릴 수 없는 특성을 가지고 있다.

`MD5`, `SHA`, `SHA2`등의 함수들이 대표적인 해시 함수의 예 이다. md5는 128비트로 축약시키며 SHA2 512의 경우는 512비트로 축약 시킨다. 128비트의 경우에도 2^128제곱을 표현할 수 있기 때문에 사실상 충돌이 발생하기는 어렵다. md5의 경우에는 개발된 지 오래 되기 때문에 매핑된 많은 테이블이 존재하고, 설계상 결함, 해시 충돌 등 많은 문제점들이 발생되어 사용되지 않고 있으며 현재는 주로 SHA2를 이용하여 사용하고있다.

이러한 해시 함수는 되돌릴 수 없는 특성 때문에 많이 사용되곤 하지만 암복호화는 전혀 다른 특성을 가지고 있다. 암호화는 복호화와 세트로서 암호화 된 값은 특정 방식을 이용해 다시 원래 값으로 복호화를 할 수 있다. 하지만 해시 함수는 데이터를 축약화 하는 것이기 때문에 절대로 해쉬값을 통해 원본값을 구할 수 없다.

#### 암호화 방식(대칭키, 공개키)

암호화 방식에는 크개 공개키 암호화 방식과 대칭키를 이용한 암호화 방식이 있다. 이 둘은 서로 다른 개념이기 때문에 각각의 특성에 맞게 다른 용도로 사용된다.

##### 대칭키 암호화

대칭키 암호화는 하나의 키를 이용해서 암, 복호화를 모두 하는 방법이다. 간단한 예를 들어 'ABC'라느 문자열이 존재하고, 키를 3으로 정한상태에서 암호화를 A+3, B+3, C+3과 같은 방식으로 암호화 해 'DEF'라는 문자열을 만들어 낼 수 있다., 복호화를 D-3, E-3, F-3같은 방식으로 원래의 값인 'ABC'로 복화 할 수 있다. 이처럼 하나의 키를 가지고 암호화, 복호화를 하는 방식을 대칭키 암호화라고 한다.

이러한 대칭키 암호화에는 문제점이 있는데, 서버와 클라이언트간에 위와 같은 통신을 한다고 하면 처음에 3이라는 키를 클라이언트에게 넘겨 주어야 한다. 이때 중간에 누군가가 이 키를 가로챈다면 중간에서 모든 통신 과정을 지켜 볼 수 있다.

이러한 문제점이 있지만 키만 잘 보호 되면 공개키 암호화에 비해 계산속도가 빠르다는 장점을 가지고 있다.
대칭키 암호화는 블록 암호화를 주로 사용하며 종류에는 `AES`가 있다.

##### 공개키 암호화(비대칭키 암호화)

공개키 암호화 방식은 대칭키 암호화의 문제점을 해결하기 위해서 나온 방식이다. 공개키 암호화 방식은 2개의 키를 이용해 암/복호화 할 수 있다. A와 B라는 키가 존재 할 때, A키로 암호화 한 내용은 B키로 복호화 할 수 있고 B키로 암호화 한 내용은 A키를 이용해 복호화 할 수 있는 특징을 가지고 있다. 그렇기 때문에 하나의 키가 탈취 되더라도 상대적으로 대칭키 암호화에 비해 안전하다. A의 키가 탈취되더라도 A로 암호화 되어 보낸 내용은 A키로 복호화 할 수가 없기 때문이다.
